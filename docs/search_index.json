[["index.html", "NYC Yellow Taxi Data Chapter 1 Introduction", " NYC Yellow Taxi Data Yiming Li 2022-05-05 Chapter 1 Introduction Yellow Taxi have served as the international icon of New York City, but after Uber first launched in New York City in 2011, this new ride sharing service has undoubtedly affected the traditional taxi industry. However, in recent years, as Uber fares surge and with the launch of the taxi app “Curb”,Yellow Taxi is becoming popular again. Ride-sharing companies such as Uber have traditionally had a competitive, antagonistic relationship with taxi companies, but this year Uber is teaming up with taxi companies in NYC. In the long development of traditional Taxi companies and the impossible partnership after years of rivalry. There are a lot of questions we can dig into by processing the Yellow Taxi and Uber data in NYC. Using NYC taxi trip data and Uber data, I am going to explore these few questions: Some basic questions about the Yellow Taxi Trip data in 2021: Where the Yellow Taxi pick-ups often occur and Is there a pattern behind the distribution of pick-ups hour in a day? What’s the possible factors that affect the number of pick-ups? Compare the hourly pick-up counts for Yellow Taxi and Uber to see if there exists some kind of association between the Yellow Taix and Uber pick-up counts in a given time period. If the crime rate of one area can influence the pick-ups for Uber/Taxi drivers? Explore two factors:payment type and pick-up time, which might be the factors that influence the tipping behavior of passengers. "],["about-the-data.html", "Chapter 2 About the Data", " Chapter 2 About the Data NYC Taxi Data: From NYC OpenData and NYC Taxi &amp; Limousine Commission. I choose Yellow Taxi Trip datasets for 2021 Jan-July, 2014 May, 2009 January and 2012 January. Each dataset contains around 17-20 variables(the number of variables slightly varies from different dataset but approximately the same). I will mainly focus on the variables “pickup_datetime”, “pickup_longitude”, “pickup_latitude”, “dropoff_longitude”, “pickup_latitude” ,“tip_amount”, “payment_type” in my analysis. These variables provide the information of precise location coordinates for where the trip started and ended, the time when the trip started and ended, the tip amount for each ride and the payment type for the Taxi fare. Pickup_datetime: The date and time when the meter was engaged. Dropoff_datetime: The date and time when the meter was disengaged. Pickup_longitude: Longitude where the meter was engaged. Pickup_latitude: Latitude where the meter was disengaged. Dropoff_longitude: Longitude where the meter was engaged. Dropoff_latitude: Latitude where the meter was disengaged. For the datasets contained small amount of data, like the 2021 Yellow Taxi Trip dataset, it only contains the data from January through July, I already downloaded it from the website and imported the data from my laptop. For the datasets contained huge amount of data, for example, 2009/2012 Yellow Taxi Trip datasets etc, I will directly import the data from its original source. Uber Data: I can only find incomplete NYC Uber data at FiveThirtyEight website from April 2014 to September 2014 and I will combine this dataset with 2014 Yellow Taxi Trip dataset. This Uber dataset only contains very sketchy information compared to the Yellow Taxi Trip dataset and it only has four variables: Date/Time (only the pickup data and time, no dropoff), Lat, Lon(the longitude and latitude of the pickup location, no dropoff), Base(the base company code affiliated with the Uber pickup, which is negligible for my analysis). So the issue I got here might influence the accuracy of my analysis because it missed a lot of valuable information. "],["data-transformation.html", "Chapter 3 Data transformation", " Chapter 3 Data transformation In historic NYC arrest dataset (building the NYC Crime Map), I extract the columns containing the data I need, which are “Latitude” and “Longitude” columns. But there are some NAs in these two columns, so I remove NAs from the data and then do the plotting. In the Yellow Taxi Trip(2021 Jan-July) dataset, which is a very big dataset that contains millions rows of data, the data loading process will take forever, so in here I sampled the data and applied the sampled data for analysis. To avoid the bias, in here I did the random sampling to randomly select the data from the original dataset. I also repeated this random sampling process to my other dataset, such as the Yellow Taxi Trip datasets in January 2009/2012 and Yellow Taxi Trip dataset for May 2014. For ploting the graph for pick-up counts for year 2009,2012, the original datasets for these two year are separated so I combine these two sample datasets together to do the further data ploting. For ploting the graph to compare hourly pick-ups for Taxi and Uber: I can only find the Uber data from April 2014 through September 2014 online and each of these datasets contains millions records of data. It will take tremendous amount of time to load each datasets, so I just gonna use only one month data for 2014 since only one month’s dataset contains millions records of data. So in here, I am also going to load Yellow Taxi Trip datasets for the same month in 2014 in order to conduct the comparison between the Uber and Taxi data later. In here, I am going to sample the Yellow Taxi dataset and get a sample dataset with same size of Uber data. "],["missing-values.html", "Chapter 4 Missing values", " Chapter 4 Missing values In the sampling dataset of Yellow Taxi Trip May 2014, as we can see from this “Percentage of missing values” plot, the only variable contains NAs are “store_and_fwd_flag” and around 50% of the values are missing. In the sampling dataset of Yellow Taxi Trip January 2009, as we can see from this “Percentage of missing values” plot, all values of these three variables are missing. ## ## 0 1 488467 ## 15 2 1 In the sampling dataset of Yellow Taxi Trip January 2012, as we can see from this “Percentage of missing values” plot, almost 50% values of “store_and_fwd_flag” are missing and only very few values of “dropoff_latitude” and “dropoff_longitude” are missing. "],["results.html", "Chapter 5 Results", " Chapter 5 Results library(tidyverse) library(sf) library(tmap) library(dplyr) library(lubridate) library(ggplot2) library(vcd) library(readxl) library(patchwork) library(ggmap) library(leaflet) #get the data directly from the original source. df_2021 &lt;-read.csv(&quot;/Users/liyiming/TaxiNYC/dataset/2021_Yellow_Taxi_Trip_Data__Jan-Jul_.csv&quot;) set.seed(0) sample_2021&lt;-sample_n(df_2021,1000000,replace = FALSE) At beginning, I will do some data analysis for the basic information of Yellow Taxi Trip dataset (Jan-July 2021) to get some insights about the distribution of pick-up locations and the distribution of pick-up time in a day. shape &lt;-read_sf(&quot;/Users/liyiming/TaxiNYC/dataset/taxi_zones/taxi_zones.shp&quot;) graph_df&lt;- as.data.frame(table(df_2021[&quot;PULocationID&quot;])) names(graph_df)[names(graph_df) ==&quot;Var1&quot;] &lt;-&quot;LocationID&quot; names(graph_df)[names(graph_df) ==&quot;Freq&quot;] &lt;-&quot;pick-ups&quot; sequence2 &lt;-c(1:263) index&lt;-sequence2[1:263%in% graph_df$LocationID] shape&lt;-shape[index,] graph_df&lt;-graph_df[-c(251,252),] graph_df$LocationID&lt;-as.numeric(graph_df$LocationID) df.2021&lt;-left_join(shape,graph_df) tm_shape(df.2021) + tm_polygons(&quot;pick-ups&quot;, palette = &quot;Blues&quot;)+ tm_text(&quot;LocationID&quot;, size = .2) *There are so missing areas for pick-ups data, that’s because I did a random sampling for the original dataset so there might be some records that the sampling dataset didn’t catch and either the original/sampling dataset doesn’t contain NAs. From this map, We can see that most of the pick-up services of Yellow Taxi are concentrated in Manhattan area and several areas in Brooklyn and Queens. Very less pick-ups occured in the place like Staten Island and Bronx area. What cause the sparse distribution of pick-ups in certain areas? I will mainly focus on two factors: the income level(from the passenger perspective) and crime rate(from the driver perspective) of certain areas. Intuitively speaking, there tend to be fewer Taxi pick-ups in low-income areas because the fare of Taxi is extremely high compared to most of the cities in United States. According to the data of US Census Bureau in 2013, 56% of the population of New York City uses the public transportation system. So hailing a Taxi seems like a thing for special occasions for most of people living in NYC. As I mentioned earlier, the fare of Taxi in NYC is extremely high, people who have low income probably won’t choose to take Taxi instead of they will choose public transportation more in their life since NYC has one of the largest public transportation systems around the world, so they can easily hop on a train/bus to the place they want to go rather than paying the extra money. In the comparison with high-income households, people are more likely to choose take a Taxi since the time costs for waiting subway/bus etc are much more higher than the money they spent on taking a Taxi. So in here, I attached the “NYC median household income distribution map” from Business Insider as a reference. In this income distribution map, We can see the household with high income located mainly at Manhattan,the border part of Brooklyn and Queens areas, little part inside Brooklyn and Staten Island.And the most low-income households concentrated at Bronx area, middle and lower part of Brooklyn. Compare the pick-up distribution map and income map, they basically follow the similar pattern: low-income area, low pick-ups. high-income area, high pick-ups. However, We can’t see this kind of relationship exists in the grey areas of the income map, because these grey areas are nonresidential neighborhoods, for example, the lower part of Brooklyn is Gateway National Recreation Area and the lower part of Queens is John F.Kennedy International Airport, so that’s why there are still a large number of pick-ups recorded for these areas even though they don’t follow the relationship with the income factor.And the other counterintuitive finding from the “distribution of pick-ups map” is that even though the median income of household in Staten Island is pretty high, the pick-ups is quite low. According to the “New York City Car Ownership Rates” data by NYCEDC in 2018, around 83% of all households in Staten Island owns a car and the ownership of a car is lowest in Manhattan(only 22% of households own a car). To some extent, this data probably can explain why there are low pick-ups in Staten Island and high pick-ups in Manhattan from another perspective. smpldata&lt;- as.factor(sample_2021$tpep_pickup_datetime) smpltime &lt;-dmy_hm(as.character(smpldata)) sample_2021$hour &lt;-hour(smpltime) hour &lt;-table(sample_2021$hour) hist(sample_2021$hour, main=&quot;Distribution of pickup hours&quot;,xlab=&quot;pick up time&quot;,ylab=&quot;taxi pick ups&quot; ,xlim=c(0,24),col=&quot;light blue&quot;) From the distribution of pick-ups for different time in a day, We can see that Taxi are available 24 hours a day. The peak hours for Taxi pick-ups are from 17:00 to 18:00, that’s probably a lot of people getting off work during that time period. And we can see the pick-ups steadily rises from 5am (that’s probably because a lot of people are getting up for the works during that time) until it hits the peak and then pick-ups drop until it hits another peak at 12am(some people finished their night shifts,going to the airport/night club/party etc, there are a lot of reasons to explain where there is a pick-up peak at 12am). Very less pick-ups in the midnight, because most of people are in the sleep during that time period. So in this graph, there is no counterintuitive finding. taxi5&lt;-read_csv(&quot;https://s3.amazonaws.com/nyc-tlc/trip+data/yellow_tripdata_2014-05.csv&quot;) set.seed(0) sample_taxi5&lt;-sample_n(taxi5,652435, replace = FALSE) uber5&lt;-read_csv(&quot;https://github.com/fivethirtyeight/uber-tlc-foil-response/raw/master/uber-trip-data/uber-raw-data-may14.csv&quot;) taxi5.h&lt;-as.numeric(format(sample_taxi5$pickup_datetime,&#39;%H&#39;)) uber5.h &lt;-as.POSIXct(uber5$`Date/Time`, format = &quot;%m/%d/%Y %H:%M:%S&quot;) uber5.h&lt;-as.numeric(format(uber5.h, format = &quot;%H&quot;)) taxi5.df&lt;-as.data.frame(table(taxi5.h)) names(taxi5.df)[names(taxi5.df) ==&quot;taxi5.h&quot;] &lt;-&quot;Hour&quot; names(taxi5.df)[names(taxi5.df) ==&quot;Freq&quot;] &lt;-&quot;pickups&quot; uber5.df&lt;-as.data.frame(table(uber5.h)) names(uber5.df)[names(uber5.df) ==&quot;uber5.h&quot;] &lt;-&quot;Hour&quot; names(uber5.df)[names(uber5.df) ==&quot;Freq&quot;] &lt;-&quot;pickups&quot; hour.df&lt;-rbind(taxi5.df,uber5.df) hour.df$Type[1:24]&lt;-&quot;Taxi&quot; hour.df$Type[24:48]&lt;-&quot;Uber&quot; hour.df$Hour&lt;-as.numeric(levels(hour.df$Hour)) ggplot(data=hour.df,aes(x=Hour,y=pickups, color=Type))+ geom_point()+ geom_line()+ labs(x=&quot;Hour&quot;,title=&quot;the distribution of pick-ups by hour&quot;)+ scale_x_discrete(limits=0:23, labels = 0:23) In the graph, I plot the distribution of pick-ups by hour of Taxi and Uber data. One thing is quite counterintuitive is that we all know the launch of Uber nearly drove the Taxi companies out of the business. But from this graph, we can see that the number of Taxi pick-ups is much higher than the number of Uber pick-ups in several time periods in a day.That’s probably because with the increase of demand to a ride, the price of Uber ride will surge. But Taxi will have a quite stable and lower price. People will turn to Taxi if the price of Uber is surging and that’s probably why during some time period, the number of Taxi pick-ups are much higher than the Uber pick-ups. They all follow a similar pick-ups distribution after the morning/evening rush hours (the number of pick-ups for Uber/Taxi all constantly rises/drops).But the pick-up peak of Taxi always lags behind the peak of Uber. We can see that the increase demand of Uber pick-up starts at 2am but the increase demand for Taxi pick-up starts at 5am(lag behind around 3 hours).Uber pick-up hits its first peak at 7am but Taxi pick-up hits its small peak at 9am. And there are more Uber pick-ups than Taxi pick-ups during the rush hour, that’s probably because people can more easily find a Uber than Taxi since they have no choice. taxi.09&lt;-read_csv(&quot;https://s3.amazonaws.com/nyc-tlc/trip+data/yellow_tripdata_2009-01.csv&quot;) taxi.12&lt;-read_csv(&quot;https://s3.amazonaws.com/nyc-tlc/trip+data/yellow_tripdata_2012-01.csv&quot;) set.seed(0) sample09 &lt;-sample_n(taxi.09,1000000, replace = FALSE) sample12 &lt;-sample_n(taxi.12,1000000, replace = FALSE) #count the pick-ups trip for each day the same month for year 2009,2012,2015 sample09.d&lt;-format(as.Date(sample09$Trip_Pickup_DateTime,format=&quot;%Y-%m-%d&quot;), format = &quot;%d&quot;) sample12.d&lt;-format(as.Date(sample12$pickup_datetime,format=&quot;%Y-%m-%d&quot;), format = &quot;%d&quot;) d09&lt;-as.data.frame(table(sample09.d)) names(d09)[names(d09) ==&quot;sample09.d&quot;] &lt;-&quot;Day&quot; d12&lt;-as.data.frame(table(sample12.d)) names(d12)[names(d12) ==&quot;sample12.d&quot;] &lt;-&quot;Day&quot; bind2&lt;-bind_rows(d09, d12) bind2$Year[1:31]&lt;-&quot;2009&quot; bind2$Year[32:62]&lt;-&quot;2012&quot; bind2$Day&lt;-as.numeric(levels(bind2$Day)) ggplot(data=bind2,aes(x=Day,y=Freq, color=Year))+ geom_point()+ geom_line()+ labs(x=&quot;Day&quot;,y=&quot;pick-ups&quot;,title=&quot;Number of pick-ups by day for January 2009/2012&quot;)+ scale_x_discrete(limits=1:31, labels = 1:31) In 2011, Uber launched in NYC. So in here I want to compare the count of pick-ups in January 2009(the year before Uber launch) and in the same month of 2012 (the year after Uber launch) to see if the launch of Uber impacted the Taxi business in NYC. As we can see from this graph, in the first day of January 2012, the pick-ups drops drastically compared to the same day in 2009.They both have a lot of fluctations, up and downs. At the peak of 2009 Taxi pick-ups, the pick-ups of 2012 drops, vice versa.But the overall pattern is that with the launch of Uber, the pick-ups of Taxi decrease. arrest_data&lt;-read_csv(&quot;https://data.cityofnewyork.us/api/views/8h9b-rp9u/rows.csv?accessType=DOWNLOAD&quot;) arrest_data&lt;-select(arrest_data,Latitude,Longitude,) arrest_data&lt;-arrest_data[!is.na(arrest_data$Latitude),] map.NY&lt;- get_map(&quot;New York&quot; , zoom=10) ggmap(map.NY)+ geom_point(data=arrest_data, aes(x=Longitude,y=Latitude), color=&#39;green&#39;,size=0.005,alpha=0.005)+ theme(axis.ticks = element_blank(), axis.text = element_blank())+ xlab(&#39;&#39;)+ylab(&#39;&#39;)+ ggtitle(&quot;NYC Crime Map based on the historical arrest data&quot;)+ theme(plot.title = element_text(size=10)) p1 &lt;-ggmap(map.NY) + geom_point(data=sample_taxi5, aes(x=pickup_longitude,y=pickup_latitude), color=&#39;blue&#39;,size=0.01,alpha=0.05)+ theme(axis.ticks = element_blank(), axis.text = element_blank())+ xlab(&#39;&#39;)+ylab(&#39;&#39;)+ ggtitle(&quot;The Count of Yellow Taxi Pick-ups for May 2014&quot;)+ theme(plot.title = element_text(size=10)) p2&lt;-ggmap(map.NY) + geom_point(data=uber5, aes(x=Lon,y=Lat), color=&#39;red&#39;,size=0.01,alpha=0.05)+ theme(axis.ticks = element_blank(), axis.text = element_blank())+ xlab(&#39;&#39;)+ylab(&#39;&#39;)+ ggtitle(&quot;The Count of Uber Pick-ups for May 2014&quot;)+ theme(plot.title = element_text(size=10)) p1+p2 In the NYC Crime Map, we can see midtown Manhattan, Harlem, Bronx, Brooklyn and large area of Queens all have high crime rates. In order to see if the crime rate is a factor that influences the pick-up of Uber/Taxi(from driver perspective, because some drivers might take this factor into consideration when they do the pick-up). From the left graph, Yellow Taxi pick-ups are more concentrated in Manhattan area and there are only few pick-ups in the Bronx area and the middle part of Brooklyn (areas with higher crime rate). In the right graph, We can see Uber pick-ups are spread out everywhere even in these high crime rate areas where Taxi drivers won’t choose to go often. So from these findings, Uber drivers might consider this factor less important than the Taxi drivers, but to a extent, crime rate of one area is one of the factors that affect the number of pick-ups in NYC. sample_2021&lt;-sample_2021[!sample_2021$tip_amount&lt;0,] sample_2021$tip.percent &lt;-round(sample_2021$tip_amount/sample_2021$total_amount,2) sample_2021$tip.categories &lt;-cut(sample_2021$tip.percent, breaks=c(0,0.1,0.2,Inf),labels=c(&quot;low tips&quot;,&quot;medium tips&quot;,&quot;high tips&quot;),include.lowest = TRUE) sample_2021$tip.categories &lt;-as.factor(sample_2021$tip.categories) sample_2021&lt;-sample_2021[!is.na(sample_2021$tip.categories)==TRUE,] ggplot(sample_2021, aes(payment_type,fill=tip.categories))+ geom_bar(position=&quot;stack&quot;)+ xlab(&quot;payment type&quot;)+ylab(&quot;count&quot;)+ ggtitle(&quot;the distribution of tip categories over different payment type&quot;, subtitle = &quot;1= Credit Card 2= Cash 3= No Charge 4= Dispute&quot;)+ coord_flip() In order to see the possible factors that affect the tipping behavior of passengers, I am ploting the distribution of tip categories over different payment method. In our data, We have four types of payment type: credit card, cash, no charge and dispute. From the graph, We can see that when the payment type is credit card, the passengers give tips in a various range from low to high and in the most situations they can get tips. But if the payment type is cash, there are only few tips data recorded, this doesn’t mean that people who pay in cash won’t give a good tip, that’s probably because the data of tip in cash didn’t state in the data. So from the graph, this payment type method can’t help us draw a persuasive conclusion that there exists a clear relationship between the tips and payment type because there are lot of missing data. ggplot(sample_2021,aes(hour,fill=tip.categories))+ geom_bar(position =&quot;stack&quot;) + xlab(&quot;pick up time&quot;)+ylab(&quot;count&quot;)+ggtitle(&quot;the distribution of tip categories over different pick-up time period&quot;) + coord_flip() In this graph, besides considering the payment type as a factor that affect the tipping behavior of passengers, We want to see if the pick-up time in a day can be one of these factors. Passengers tend to give generous tips during the evening rush hours(5pm-7pm). And in the early morning and late night, passengers tend to give low tips. map.cu&lt;- get_map(location = c(lon =-73.963036, lat =40.807384) , zoom=17) lon =c(-73.9640,-73.963036) lat =c(40.8069,40.8095) taxi.pickup &lt;- sample12 %&gt;% filter(pickup_longitude &gt; lon[1] &amp; pickup_longitude &lt; lon[2], pickup_latitude &gt; lat[1] &amp; pickup_latitude &lt; lat[2]) ggmap(map.cu) + geom_point(data=taxi.pickup, aes(x=pickup_longitude,y=pickup_latitude),size=.03,alpha=0.3,color=&quot;red&quot;)+ ggtitle(&#39;Taxi Pickups near Columbia University&#39;) ny.map &lt;- get_map(&quot;Central Park, New York, NY&quot;, color=&quot;bw&quot;,zoom=11) ggmap(ny.map) + geom_point(data=taxi.pickup, aes(x=pickup_longitude,y=pickup_latitude),size=.5,alpha=0.5,color=&quot;red&quot;)+ geom_point(data=taxi.pickup, aes(x=dropoff_longitude,y=dropoff_latitude), color=&quot;blue&quot;,size=0.5,alpha=0.5)+ ggtitle(&#39;Taxi Dropoffs from Columbia University in Blue&#39;) I first plot the Taxi pick-ups near Columbia University and then plot the dropoff locations of these pick-ups in order to see where the people go from Columbia University. Since I only plot the pick-ups around Columbia University and Banard College, so I am thinking the most of these pick-up rides are probably requested by Columbia and Banard students. And maybe the drop-off locations of these rides can act as an indicator about where the students attend Columbia and Banard live. In the Taxi dropoffs map, We can see that the most of rides ended at Upper East Side Upper West Side and the areas that are close to the schools.Few dropoff locations are at Booklyn and the rest areas in Manhattan, such as West Village and Tribeca.If this is an indicator about where the students attend Columbia and Banard live, it actually makes a lot of sense since students prefer to live in the places that are close to the school so that they won’t waste a lot of time on the commute. And we can see it from the graph, there are very few people go to the places(like Brooklyn) that are far away from school by Taxi. ``` "],["interactive-component.html", "Chapter 6 Interactive component", " Chapter 6 Interactive component "],["conclusion.html", "Chapter 7 Conclusion", " Chapter 7 Conclusion Takeways: 1.There are more pick-ups in wealthy neighborhood compared to poor neighborhood. 2.The demand for pick-ups hit the peak at the rush hours. 3.People tend to take Taxi instead of Uber during the off-peak time period because of the lower fare of Taxi. 4.With the launch of Uber, pick-ups for Taxi drops and Uber has huge impact on the Taxi business. 5.The crime rate of one area probably will influence the pick-up patterns for Uber and Taxi drivers. 6.Tipping behavior of passengers might be influenced by the payment type and pick-up hour. Limitations: Data is incomplete, for example, only limit data for Uber rides available online, so the result probably is not accurate and not comprehensive. And the available datasets are too large, so I only use one month data for Uber/Taxi trips analysis and there will exist some error or inconsistency in my data analysis compared to the analysis with more data. And in some datasets, it only has LocationID instead of specific coordinates so it’s kind of difficult for me to convert the data into a right form. Lesson learned: learn new packages for ploting the map and arranging the plot. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
